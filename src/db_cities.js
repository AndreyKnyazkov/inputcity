const data = {
    "RU": [
        {
            "country": "Россия",
            "count": "144500000",
            "cities": [
                {
                    "name": "Рязань",
                    "count": "538962",
                    "link": "https://ru.wikipedia.org/wiki/%D0%A0%D1%8F%D0%B7%D0%B0%D0%BD%D1%8C"
                },
                {
                    "name": "Москва",
                    "count": "12615882",
                    "link": "https://ru.wikipedia.org/wiki/%D0%9C%D0%BE%D1%81%D0%BA%D0%B2%D0%B0"
                },
                {
                    "name": "Санкт-Петербург",
                    "count": "5383968",
                    "link": "https://ru.wikipedia.org/wiki/%D0%A1%D0%B0%D0%BD%D0%BA%D1%82-%D0%9F%D0%B5%D1%82%D0%B5%D1%80%D0%B1%D1%83%D1%80%D0%B3"
                },
                {
                    "name": "Краснодар",
                    "count": "918145",
                    "link": "https://ru.wikipedia.org/wiki/%D0%9A%D1%80%D0%B0%D1%81%D0%BD%D0%BE%D0%B4%D0%B0%D1%80"
                },
                {
                    "name": "Екатеринбург",
                    "count": "1484456",
                    "link": "https://ru.wikipedia.org/wiki/%D0%95%D0%BA%D0%B0%D1%82%D0%B5%D1%80%D0%B8%D0%BD%D0%B1%D1%83%D1%80%D0%B3"
                },
                {
                    "name": "Ростов-на-Дону",
                    "count": "1130305",
                    "link": "https://ru.wikipedia.org/wiki/%D0%A0%D0%BE%D1%81%D1%82%D0%BE%D0%B2-%D0%BD%D0%B0-%D0%94%D0%BE%D0%BD%D1%83"
                },
                {
                    "name": "Воронеж",
                    "count": "1054537",
                    "link": "https://ru.wikipedia.org/wiki/%D0%92%D0%BE%D1%80%D0%BE%D0%BD%D0%B5%D0%B6"
                }
            ]

        },
        {
            "country": "Германия",
            "count": 82175684 ,
            "cities": [
                {
                    "name": "Берлин",
                    "count": "3613495",
                    "link": "https://ru.wikipedia.org/wiki/%D0%91%D0%B5%D1%80%D0%BB%D0%B8%D0%BD"
                },
                {
                    "name": "Мюнхен",
                    "count": "1456039",
                    "link": "https://ru.wikipedia.org/wiki/%D0%9C%D1%8E%D0%BD%D1%85%D0%B5%D0%BD"
                },
                {
                    "name": "Франкфурт-на-Майне",
                    "count": "736414",
                    "link": "https://ru.wikipedia.org/wiki/%D0%A4%D1%80%D0%B0%D0%BD%D0%BA%D1%84%D1%83%D1%80%D1%82-%D0%BD%D0%B0-%D0%9C%D0%B0%D0%B9%D0%BD%D0%B5"
                },
                {
                    "name": "Кёльн",
                    "count": "1080394",
                    "link": "https://ru.wikipedia.org/wiki/%D0%9A%D1%91%D0%BB%D1%8C%D0%BD"
                }
            ]
        },
        {
            "country": "Англия",
            "count": 53012456,
            "cities": [
                {
                    "name": "Лондон",
                    "count": "8869898",
                    "link": "https://ru.wikipedia.org/wiki/%D0%9B%D0%BE%D0%BD%D0%B4%D0%BE%D0%BD"
                },
                {
                    "name": "Манчестер",
                    "count": "545500",
                    "link": "https://ru.wikipedia.org/wiki/%D0%9C%D0%B0%D0%BD%D1%87%D0%B5%D1%81%D1%82%D0%B5%D1%80"
                },
                {
                    "name": "Эдинбург",
                    "count": "488100",
                    "link": "https://ru.wikipedia.org/wiki/%D0%AD%D0%B4%D0%B8%D0%BD%D0%B1%D1%83%D1%80%D0%B3"
                },
                {
                    "name": "Бристоль",
                    "count": "567111",
                    "link": "https://ru.wikipedia.org/wiki/%D0%91%D1%80%D0%B8%D1%81%D1%82%D0%BE%D0%BB%D1%8C"
                }
            ]

        }
    ],
    "EN": [
        {
            "country": "Russia",
            "count": "144500000",
            "cities": [
                {
                    "name": "Ryazan",
                    "count": "538962",
                    "link": "https://ru.wikipedia.org/wiki/%D0%A0%D1%8F%D0%B7%D0%B0%D0%BD%D1%8C"
                },
                {
                    "name": "Moscow",
                    "count": "12615882",
                    "link": "https://ru.wikipedia.org/wiki/%D0%9C%D0%BE%D1%81%D0%BA%D0%B2%D0%B0"
                },
                {
                    "name": "St Petersburg",
                    "count": "5383968",
                    "link": "https://ru.wikipedia.org/wiki/%D0%A1%D0%B0%D0%BD%D0%BA%D1%82-%D0%9F%D0%B5%D1%82%D0%B5%D1%80%D0%B1%D1%83%D1%80%D0%B3"
                },
                {
                    "name": "Krasnodar",
                    "count": "918145",
                    "link": "https://ru.wikipedia.org/wiki/%D0%9A%D1%80%D0%B0%D1%81%D0%BD%D0%BE%D0%B4%D0%B0%D1%80"
                },
                {
                    "name": "Yekaterinburg",
                    "count": "1484456",
                    "link": "https://ru.wikipedia.org/wiki/%D0%95%D0%BA%D0%B0%D1%82%D0%B5%D1%80%D0%B8%D0%BD%D0%B1%D1%83%D1%80%D0%B3"
                },
                {
                    "name": "Rostov-on-Don",
                    "count": "1130305",
                    "link": "https://ru.wikipedia.org/wiki/%D0%A0%D0%BE%D1%81%D1%82%D0%BE%D0%B2-%D0%BD%D0%B0-%D0%94%D0%BE%D0%BD%D1%83"
                },
                {
                    "name": "Voronezh",
                    "count": "1054537",
                    "link": "https://ru.wikipedia.org/wiki/%D0%92%D0%BE%D1%80%D0%BE%D0%BD%D0%B5%D0%B6"
                }
            ]

        },
        {
            "country": "Germany",
            "count": 82175684 ,
            "cities": [
                {
                    "name": "Berlin",
                    "count": "3613495",
                    "link": "https://ru.wikipedia.org/wiki/%D0%91%D0%B5%D1%80%D0%BB%D0%B8%D0%BD"
                },
                {
                    "name": "Munich",
                    "count": "1456039",
                    "link": "https://ru.wikipedia.org/wiki/%D0%9C%D1%8E%D0%BD%D1%85%D0%B5%D0%BD"
                },
                {
                    "name": "frankfurt",
                    "count": "736414",
                    "link": "https://ru.wikipedia.org/wiki/%D0%A4%D1%80%D0%B0%D0%BD%D0%BA%D1%84%D1%83%D1%80%D1%82-%D0%BD%D0%B0-%D0%9C%D0%B0%D0%B9%D0%BD%D0%B5"
                },
                {
                    "name": "Cologne",
                    "count": "1080394",
                    "link": "https://ru.wikipedia.org/wiki/%D0%9A%D1%91%D0%BB%D1%8C%D0%BD"
                }
            ]
        },
        {
            "country": "United Kingdom",
            "count": 53012456,
            "cities": [
                {
                    "name": "London",
                    "count": " 8869898",
                    "link": "https://ru.wikipedia.org/wiki/%D0%9B%D0%BE%D0%BD%D0%B4%D0%BE%D0%BD"
                },
                {
                    "name": "Manchester",
                    "count": "545500",
                    "link": "https://ru.wikipedia.org/wiki/%D0%9C%D0%B0%D0%BD%D1%87%D0%B5%D1%81%D1%82%D0%B5%D1%80"
                },
                {
                    "name": "Edinburgh",
                    "count": "488100",
                    "link": "https://ru.wikipedia.org/wiki/%D0%AD%D0%B4%D0%B8%D0%BD%D0%B1%D1%83%D1%80%D0%B3"
                },
                {
                    "name": "Bristol",
                    "count": "567111",
                    "link": "https://ru.wikipedia.org/wiki/%D0%91%D1%80%D0%B8%D1%81%D1%82%D0%BE%D0%BB%D1%8C"
                }
            ]

        }
    ],
    "DE": [
        {
            "country": "Russland",
            "count": "144500000",
            "cities": [
                {
                    "name": "Ryazan",
                    "count": "538962",
                    "link": "https://ru.wikipedia.org/wiki/%D0%A0%D1%8F%D0%B7%D0%B0%D0%BD%D1%8C"
                },
                {
                    "name": "Moskau",
                    "count": "12615882",
                    "link": "https://ru.wikipedia.org/wiki/%D0%9C%D0%BE%D1%81%D0%BA%D0%B2%D0%B0"
                },
                {
                    "name": "Saint Petersburg",
                    "count": "5383968",
                    "link": "https://ru.wikipedia.org/wiki/%D0%A1%D0%B0%D0%BD%D0%BA%D1%82-%D0%9F%D0%B5%D1%82%D0%B5%D1%80%D0%B1%D1%83%D1%80%D0%B3"
                },
                {
                    "name": "Krasnodar",
                    "count": "918145",
                    "link": "https://ru.wikipedia.org/wiki/%D0%9A%D1%80%D0%B0%D1%81%D0%BD%D0%BE%D0%B4%D0%B0%D1%80"
                },
                {
                    "name": "Jekaterinburg",
                    "count": "1484456",
                    "link": "https://ru.wikipedia.org/wiki/%D0%95%D0%BA%D0%B0%D1%82%D0%B5%D1%80%D0%B8%D0%BD%D0%B1%D1%83%D1%80%D0%B3"
                },
                {
                    "name": "Rostow",
                    "count": "1130305",
                    "link": "https://ru.wikipedia.org/wiki/%D0%A0%D0%BE%D1%81%D1%82%D0%BE%D0%B2-%D0%BD%D0%B0-%D0%94%D0%BE%D0%BD%D1%83"
                },
                {
                    "name": "Woronesch",
                    "count": "1054537",
                    "link": "https://ru.wikipedia.org/wiki/%D0%92%D0%BE%D1%80%D0%BE%D0%BD%D0%B5%D0%B6"
                }
            ]

        },
        {
            "country": "Deutschland",
            "count": 82175684 ,
            "cities": [
                {
                    "name": "Berlin",
                    "count": "3613495",
                    "link": "https://ru.wikipedia.org/wiki/%D0%91%D0%B5%D1%80%D0%BB%D0%B8%D0%BD"
                },
                {
                    "name": "München",
                    "count": "1456039",
                    "link": "https://ru.wikipedia.org/wiki/%D0%9C%D1%8E%D0%BD%D1%85%D0%B5%D0%BD"
                },
                {
                    "name": "Frankfurt",
                    "count": "736414",
                    "link": "https://ru.wikipedia.org/wiki/%D0%A4%D1%80%D0%B0%D0%BD%D0%BA%D1%84%D1%83%D1%80%D1%82-%D0%BD%D0%B0-%D0%9C%D0%B0%D0%B9%D0%BD%D0%B5"
                },
                {
                    "name": "Köln",
                    "count": "1080394",
                    "link": "https://ru.wikipedia.org/wiki/%D0%9A%D1%91%D0%BB%D1%8C%D0%BD"
                }
            ]
        },
        {
            "country": "England",
            "count": 53012456,
            "cities": [
                {
                    "name": "London",
                    "count": " 8869898",
                    "link": "https://ru.wikipedia.org/wiki/%D0%9B%D0%BE%D0%BD%D0%B4%D0%BE%D0%BD"
                },
                {
                    "name": "Manchester",
                    "count": "545500",
                    "link": "https://ru.wikipedia.org/wiki/%D0%9C%D0%B0%D0%BD%D1%87%D0%B5%D1%81%D1%82%D0%B5%D1%80"
                },
                {
                    "name": "Edinburgh",
                    "count": "488100",
                    "link": "https://ru.wikipedia.org/wiki/%D0%AD%D0%B4%D0%B8%D0%BD%D0%B1%D1%83%D1%80%D0%B3"
                },
                {
                    "name": "Bristol",
                    "count": "567111",
                    "link": "https://ru.wikipedia.org/wiki/%D0%91%D1%80%D0%B8%D1%81%D1%82%D0%BE%D0%BB%D1%8C"
                }
            ]

        }
    ]
};




const countries = data.RU,
  input = document.getElementById('select-cities'),
  dropdownListsListDefault = document.querySelector('.dropdown-lists__list--default'),
  dropdownListsListSelect = document.querySelector('.dropdown-lists__list--select'),
  dropdownListsListAutocomlete = document.querySelector('.dropdown-lists__list--autocomplete'),
  dropdown = document.querySelector('.dropdown'),
  //создание элементов
  countryElem = document.createElement('div'),
  dropdownListsCol = document.createElement('div'),
  dropdownListsCountryBlock = document.createElement('div'),
  dropdownListsTotalLine = document.createElement('div'),
  dropdownListsCountry = document.createElement('div'),
  dropdownListsCount = document.createElement('div'),
  dropdownListsCity = document.createElement('div'),
  dropdownListsLine = document.createElement('div');
  //присваивание элементам классов
  dropdownListsCol.classList.add('dropdown-lists__col');
  dropdownListsCountryBlock.classList.add('dropdown-lists__countryBlock');
  dropdownListsTotalLine.classList.add('dropdown-lists__total-line');
  dropdownListsCountry.classList.add('dropdown-lists__country');
  dropdownListsCount.classList.add('dropdown-lists__count');
  dropdownListsCity.classList.add('dropdown-lists__city');
  dropdownListsLine.classList.add('dropdown-lists__line');
//объект всех существующих городов
const allCityes = [...countries[0].cities, ...countries[1].cities, ...countries[2].cities];


  console.log('allCityes: ', allCityes);

for (let i = 0; i <= data.RU.length - 1; i++) {
  countries[i].cities.sort((prev, next) => next.count - prev.count);
}

console.log('Общий список стран international', data);
console.log('Страны ', countries);

//пишем функционал для вывода значений при вводе значений в input
const hideInfo = (item1, active, wiki) => {

    input.addEventListener('click', (event) => {
      item1();
    });

    input.addEventListener('input', (event) => {
      active();
    });

    wiki();
    
    dropdownListsListDefault.addEventListener('click', () => {
      
      const dropdownListsCountry = document.querySelectorAll('.dropdown-lists__country');

      let target = event.target;
      //если он не существует то создаю его      
      dropdownListsCountry.forEach((item, count) => {
        if (target === dropdownListsCountry[count]) {
          //скрытие ненужных элементов и открытие нужных
          document.querySelector('.dropdown-lists__list--default').style.display = 'none';
          document.querySelector('.dropdown-lists__list--select').style.display = 'block';

          //узнаю содержимое выбранного элемента
          let selectCountry = dropdownListsCountry[count].textContent;
          const dropdownListsListSelect = document.querySelector('.dropdown-lists__list--select'),
            //колонка
            dropdownListsCol = document.createElement('div'),
            //блок
            dropdownListsCountryBlock = document.createElement('div'),
            //страна и население
            dropdownListsTotalLine = document.createElement('div');
            //если элемент со страной уже есть, то удаляем его
            const existsCountry = document.querySelector('.dropdown-lists__list--select .dropdown-lists__col');
            if (!!existsCountry) {
              existsCountry.remove();
            }

          dropdownListsCol.classList.add('dropdown-lists__col');
          dropdownListsCountryBlock.classList.add('dropdown-lists__countryBlock');
          dropdownListsTotalLine.classList.add('dropdown-lists__total-line');

          dropdownListsListSelect
            .appendChild(dropdownListsCol)
            .appendChild(dropdownListsCountryBlock)
            .appendChild(dropdownListsTotalLine);

          countries.forEach((item, count) => {
            
            if (item.country === selectCountry) {           
              //вывод городов
              const countyObj = countries[count];
              
              //вставка стран
              dropdownListsTotalLine.innerHTML = `
                <div class="dropdown-lists__country">${countyObj.country}</div>
                <div class="dropdown-lists__count">${countyObj.count}</div>
              `;
              //вставка городов
              for (let key of countyObj.cities) {
              dropdownListsCountryBlock.innerHTML += `
                <div class="dropdown-lists__line">
                  <div class="dropdown-lists__city">${key.name}</div>
                  <div class="dropdown-lists__count">${key.count}</div>
                </div>
              `;
              }  
            }

          });
        }
      });
    });

};


hideInfo((elem1, elem2) => {
  
  console.log(input.value.length);
  if (!dropdownListsListDefault.childNodes[1]) {
    if (input.value.length !== 0) {
      console.log('я ем');
      return;
    }
    //скрываем лишние элементы
    document.querySelector('.dropdown-lists__list--autocomplete').style.display = 'none';
    console.log(dropdownListsListDefault);
    dropdownListsListDefault.insertAdjacentElement('beforeend', dropdownListsCol);
    
    //создание цикла
    countries.forEach((item, count) => {

      dropdownListsTotalLine.innerHTML = `<div class="dropdown-lists__country">${item.country}</div>`;
      dropdownListsTotalLine.innerHTML += `<div class="dropdown-lists__count">${item.count}</div>`;

      let elemClone = dropdownListsCountryBlock.cloneNode(true);
      let elemClone2 = dropdownListsTotalLine.cloneNode(true);

      dropdownListsCol
        .appendChild(elemClone)
        .appendChild(elemClone2);
      for (let i = 0; i <= 2; i++) {
        const cityInfo = item.cities[i];
        elemClone.innerHTML += `
          <div class="dropdown-lists__line">
                <div class="dropdown-lists__city">${cityInfo.name}</div>
                <div class="dropdown-lists__count">${cityInfo.count}</div>
              </div>
          `;        
      }
    });
  } else {
    if (input.value.length !== 0) {
      
      return;
    }
    document.querySelector('.dropdown-lists__list--default').style.display = 'block';
    
    document.querySelector('.dropdown-lists__list--select').style.display = 'none';
    document.querySelector('.dropdown-lists__list--autocomplete').style.display = 'none';
  }
  

}, () => {
  //получаем значение, которое вводим в инпут
  let citysVar = input.value.toLowerCase();
  let citysvarLength = citysVar.length;
  
  console.log('citysVar: ', citysVar);
  console.log('citysvarLength : ', citysvarLength );
  //очищаю родительские элементы чтобы не было лишних перебивок
  document.querySelector('.dropdown-lists__list--autocomplete').style.display = 'block';
  document.querySelector('.dropdown-lists__list--default').style.display = 'none';

  //фильтруем значение, которые мы вводим в input
  const newCityes = allCityes.filter(function (element, i) {
    const reg = new RegExp(`^${citysVar}`);
    console.log();
    return (reg.test(allCityes[i].name.toLowerCase()));
  });
  //вывод значений количества городов
  console.log(newCityes);
  //обращаемся к главному родителю и выводим его контент
  const dropdownListsListAutocomlete = document.querySelector('.dropdown-lists__list--autocomplete'),
  dropdownListsCol = document.createElement('div'),
  dropdownListsCountryBlock = document.createElement('div');

  dropdownListsCol.classList.add('dropdown-lists__col');
  dropdownListsCountryBlock.classList.add('dropdown-lists__countryBlock');
  console.log(dropdownListsCol);
  // console.log(dropdownListsCountryBlock);

  // console.log('длина ', newCityes.length);
  if (citysvarLength !== 0) {
    
    dropdownListsListAutocomlete.style.display = 'block';

    if (!dropdownListsListAutocomlete.firstChild) {
      dropdownListsListAutocomlete.insertAdjacentElement('beforeend', dropdownListsCol);
      dropdownListsCol
        .appendChild(dropdownListsCountryBlock);
    }

    document.querySelector('.dropdown-lists__list.dropdown-lists__list--autocomplete .dropdown-lists__countryBlock').innerHTML = '';
    for (let key of newCityes) {
      console.log('Ключ', key);
      document.querySelector('.dropdown-lists__list.dropdown-lists__list--autocomplete .dropdown-lists__countryBlock')
      .innerHTML += `
        <div class="dropdown-lists__line">
          <div class="dropdown-lists__city">${key.name}</div>
          <div class="dropdown-lists__count">${key.count}</div>
        </div>
      `;
    }
  } else {
    
    document.querySelector('.dropdown-lists__list--autocomplete').style.display = 'none';
    document.querySelector('.dropdown-lists__list--default').style.display = 'block';
  }


}, () => {
  dropdown.addEventListener('click', (event) => {
    
    const dropdownListsCity = document.querySelectorAll('.dropdown-lists__city');
    console.log(dropdownListsCity);
    
    
    dropdownListsCity.forEach((item, i) => {
      let target = event.target;
      if (target === item) {
        console.log('да');
        //элемент на который я нажал
        let currentCity = item.textContent;
        console.log(currentCity);
        const wiki = allCityes.filter(function (element, i, b) {
          if (element.name === item.textContent) {
            return element;
          }
          
        });
        console.log(wiki);
        document.querySelector('.button').setAttribute(`href`, `${wiki[0].link}`);
      } 
    });
    
  });
  
}); 






